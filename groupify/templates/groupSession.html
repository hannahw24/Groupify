[[extend 'layout.html']]

<div id="vue-target">
    [[userPage = "user/" + session.get("userID") ]]
    <div class="group_panel panel_spec" style="background-color: white;"> 

        <!-- get back to profile -->
        <a class="button is-primary" href="[[=URL(userPage)]]">
            <i class="fa fa-backward" aria-hidden="true"></i>
            &nbsp; Back
        </a>

        <figure class="image is-128x128 profile_photo group_pfp">
            [[if (profile_pic != ""):]]
            <img class="is-rounded" src="[[=(profile_pic)]]">
            [[else:]]
            <img class="is-rounded" src="https://bulma.io/images/placeholders/128x128.png">
            [[pass]]
        </figure>
        <div class="box" style="width:25%;">
            Friend 1
        </div>
        <div class="box" style="width:25%;">
            Friend 2
        </div>
        <div class="box" style="width:25%;">
            Friend 3
        </div>
        <div class="box" style="width:25%;">
            Friend 4
        </div>
    </div>
    <div class="queue_panel panel_spec" style="background-color: white;"> 
        <div class="box">
          <iframe :src="playingTrackURI" style="width:400px;height:410px;" frameborder="0" allowtransparency="true" allow="encrypted-media"></iframe>
          <!--
            <figure class="image">
                <img :src="playingTrackImage">
            </figure>
          -->
        </div>
        <!-- 
        <strong>{{playingTrackName}}</strong> <br>
        {{playingTrackArtist}}
        -->
    </div>

</div>
<script src="https://sdk.scdn.co/spotify-player.js"></script>
<script>
  window.onSpotifyWebPlaybackSDKReady = () => {
    const token = '[[=(token)]]';
    const player = new Spotify.Player({
      name: 'Groupify Website',
      getOAuthToken: cb => { cb(token); }
    });

    // Error handling
    player.addListener('initialization_error', ({ message }) => { console.error(message); });
    player.addListener('authentication_error', ({ message }) => { console.error(message); });
    player.addListener('account_error', ({ message }) => { console.error(message); });
    player.addListener('playback_error', ({ message }) => { console.error(message); });

    // Playback status updates
    player.addListener('player_state_changed', state => { console.log(state); });

    // Ready
    player.addListener('ready', ({ device_id }) => {
      console.log('Ready with Device ID', device_id);
    });

    // Not Ready
    player.addListener('not_ready', ({ device_id }) => {
      console.log('Device ID has gone offline', device_id);
    });

    // Connect to the player!
    player.connect();
    
  };
</script>

[[block page_scripts]]
<script>
    let currentPlaying = "[[=XML(currentPlaying)]]";
</script>
<script src="js/groupSession.js"></script>
[[end]]